
\newcommand{\figureDecompositionDefHelpersContent}{%
\begin{align*}
  \children(v, p) &= \SetOf{\e = (u, v, p, v') \SuchThat{G(\e) = \Plus}} \\
  \parents(v) &= \SetOf{\e = (u, v', p, v) \SuchThat{G(\e) = \Plus}} \\
  \ancestors(v) &= \mathopen{}\left( \lfp(\ancestors') \right)\mathclose{}(v) \\
  \ancestors'(v) &= \parents(v) \cup \ancestors'(\parents(v)) \\
  % \min{(u_1, v_1, p_1, v_1'), \ldots, (u_n, v_n, p_n, v_n')} &= \min{v_1', \ldots, v_n'} \\
  \min{(u_1, k_1), \ldots, (u_n, k_n)} &= (u_j, k_j) \text{ s.t. } 1 \leq j \leq n \land u_j \le u_i \forall i = 1, \ldots, n
\end{align*}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\figureDecompositionDefDecomp}{%
\begin{align*}
  \decomp{G} &= ((NP, MP, U), D) \\
  \figureDecompositionDefDecompComponents \\
  D &= \SetOf{\e \SuchThat{G(\e) = \Minus}}
\end{align*}%
}

\newcommand{\figureDecompositionDefDecompComponents}{%
  NP &= \SetOf{\edecomp{\e} \SuchThat{|\parents(\e)| = 0}} \\
  MP &= \SetOf{\edecomp{\e} \SuchThat{|\parents(\e)| > 1}} \\
  U &= \SetOf{\edecomp{\e} \SuchThat{|\parents(\e)| = 1 \land \e \in \min{\ancestors(\e)}}}%
}

\newcommand{\figureDecompositionDefEdecomp}{%
\begin{align*}
  % \edecomp{v=(u, Root)} &= \edecompPrime{v}{Root} \\
  \edecomp{\e=(u, v, p, (u', \ExpVar(x)))} &= \eVar{\parents(\e)}{u'}{x} \\
  \edecomp{\e=(u, v, p, (u', \ExpLam))} &= \eFun{\parents(\e)}{u'}{q}{\tau}{e} \\
  & q = \pdecompPrime{\e}{\LamParam} \\
  & \tau = \tdecompPrime{\e}{\LamType} \\
  & e = \edecompPrime{\e}{\LamBody} \\
  \edecomp{\e=(u, v, p, (u', \ExpApp))} &= \eApp{\parents(\e)}{u'}{e_\AppFun}{e_\AppArg} \\
  & e_\AppFun = \edecompPrime{\e}{\AppFun} \\
  & e_\AppArg = \edecompPrime{\e}{\AppArg} \\
  \edecomp{\e=(u, v, p, (u', \ExpNum(n)))} &= \eNum{\parents(\e)}{u'}{n} \\
  \edecomp{\e=(u, v, p, (u', \ExpPlus))} &= \ePlus{\parents(\e)}{u'}{e_\PlusLeft}{e_\PlusRight} \\
  & e_\PlusLeft = \edecompPrime{\e}{\PlusLeft} \\
  & e_\PlusRight = \edecompPrime{\e}{\PlusRight} \\
  \edecomp{\e=(u, v, p, (u', \ExpTimes))} &= \eTimes{\parents(\e)}{u'}{e_\TimesLeft}{e_\TimesRight} \\
  & e_\TimesLeft = \edecompPrime{\e}{\TimesLeft} \\
  & e_\TimesRight = \edecompPrime{\e}{\TimesRight}
\end{align*}%
}

\newcommand{\figureDecompositionDefPdecomp}{%
\begin{align*}
  \pdecomp{\e=(u, v, p, (u', \PatVar(x)))} &= \pVar{\parents(\e)}{u}{x}
\end{align*}%
}

\newcommand{\figureDecompositionDefTdecomp}{%
\begin{align*}
  \tdecomp{\e=(u, v, p, (u', \TypArrow))} &= \tArrow{\parents(\e)}{u'}{\tau_\ArrowArg}{\tau_\ArrowResult} \\
  & \tau_\ArrowArg = \tdecompPrime{\e}{\ArrowArg} \\
  & \tau_\ArrowResult = \tdecompPrime{\e}{\ArrowResult} \\
  \tdecomp{\e=(u, v, p, (u', \TypNum))} &= \tNum{\parents(\e)}{u'}
\end{align*}%
}

\newcommand{\figureDecompositionDefEdecompPrime}{%
\[
  \begin{array}{l}
    \edecompPrime{\e}{p} = \\
    \left\{
    \begin{array}{ll}
      \conflictHole{\edecomp{\e_1}, \ldots, \edecomp{\e_n}} & \children(\e,p) = \SetOf{\e_1, \ldots, \e_n} \land |\children(\e')| > 1 \\
      \multiVertex{u} & \children(\e,p) = \SetOf{\e'} \land |\parents(\e')| > 1 \\
      \cycleVertex{u} & \children(\e,p) = \SetOf{\e'} \land |\parents(\e')| = 1 \\
          & \phantom{\children(\e,p) = \SetOf{\e'}} \land \e' \in \min{\ancestors(\e')} \\
      \hole & \children(\e,p) = \varnothing \\
      \edecomp{\e} & \text{otherwise} \\
    \end{array}
    \right.
  \end{array}
\]%
}

\newcommand{\figureDecompositionDefPdecompPrime}{%
\[
  \begin{array}{l}
    \pdecompPrime{\e}{p} = \\
    \left\{
    \begin{array}{ll}
      \conflictHole{\pdecomp{\e_1}, \ldots, \pdecomp{\e_n}} & \children(\e,p) = \SetOf{\e_1, \ldots, \e_n} \land |\children(\e')| > 1 \\
      \multiVertex{u} & \children(\e,p) = \SetOf{\e'} \land |\parents(\e')| > 1 \\
      \cycleVertex{u} & \children(\e,p) = \SetOf{\e'} \land |\parents(\e')| = 1 \\
          & \phantom{\children(\e,p) = \SetOf{\e'}} \land \e' \in \min{\ancestors(\e')} \\
      \hole & \children(\e,p) = \varnothing \\
      \pdecomp{\e} & \text{otherwise} \\
    \end{array}
    \right.
  \end{array}
\]%
}

\newcommand{\figureDecompositionDefTdecompPrime}{%
\[
  \begin{array}{l}
    \tdecompPrime{\e}{p} = \\
    \left\{
    \begin{array}{ll}
      \conflictHole{\tdecomp{\e_1}, \ldots, \tdecomp{\e_n}} & \children(\e,p) = \SetOf{\e_1, \ldots, \e_n} \land |\children(\e')| > 1 \\
      \multiVertex{u} & \children(\e,p) = \SetOf{\e'} \land |\parents(\e')| > 1 \\
      \cycleVertex{u} & \children(\e,p) = \SetOf{\e'} \land |\parents(\e')| = 1 \\
          & \phantom{\children(\e,p) = \SetOf{\e'}} \land \e' \in \min{\ancestors(\e')} \\
      \hole & \children(\e,p) = \varnothing \\
      \tdecomp{\e} & \text{otherwise} \\
    \end{array}
    \right.
  \end{array}
\]%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\figureDecompositionDef}{%
\begin{figure}

\figureDecompositionDefEdecomp

\figureDecompositionDefPdecomp

\figureDecompositionDefTdecomp

\figureDecompositionDefEdecompPrime

\figureDecompositionDefPdecompPrime

\figureDecompositionDefTdecompPrime

\caption{Graph decomposition.}
\label{fig:Graph decomposition definition}
\end{figure}%
}

\newcommand{\figureDecompositionDefHelpers}{%
\begin{figure}
\figureDecompositionDefHelpersContent
\caption{Graph decomposition helpers.}
\label{fig:Graph decomposition definition helpers}
\end{figure}%
}