
\newcommand{\figureDecompositionDefHelpersContent}{%
\begin{align*}
  \inedges{G} &= \SetOf{\e \SuchThat{G(\e) \in \SetOf{\Plus, \Minus}}} \\
  \sources{G} &= \SetOf{(v, p) \SuchThat{(u, v, p, v') \in \inedges{G} \land u \in \U \land v' \in \V}} \\
  \live{G} &= \SetOf{\e \SuchThat{G(\e) = \Plus}} \\
  \livesources{G} &= \SetOf{(v, p) \SuchThat{(u, v, p, v') \in \live{G} \land u \in \U \land v' \in \V}} \\
  \children{v}{p} &= \SetOf{\e{=}(u, v, p, v') \in \live{G} \SuchThat{u \in \U \land v' \in \V}} \\
  \ingraph{v} &= \SetOf{\e{=}(u, v', p, v) \mapsto G(\e) \SuchThat{\e \in \inedges{G}}} \\
  \parents{v} &= \SetOf{v' \SuchThat{(u, v', p, v) \in \live{G} \land u \in \U \land p \in \P}} \\
  \ancestors{v} &= \mathopen{}\left( \lfp{\ancestorsPrimeOp} \right)\mathclose{}(v) \\
  \ancestorsPrime{v} &= \parents{v} \cup \ancestorsPrime{\parents{v}} \\
  \min{(u_1, k_1), \ldots, (u_n, k_n)} &= (u_j, k_j) \text{ s.t. } 1 \leq j \leq n \land u_j \le u_i \forall i = 1, \ldots, n
\end{align*}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\figureDecompositionDefDecomp}{%
\begin{align*}
  \decomp{G} &= (\Set[NP], \Set[MP], \Set[U]) \\
  \figureDecompositionDefDecompComponents
\end{align*}%
}

\newcommand{\figureDecompositionDefDecompComponents}{%
  \Set[NP] &= \SetOf{\decomp{(u, v, p, v')} \SuchThat{|\parents{v'}| = 0}} \\
  \Set[MP] &= \SetOf{\decomp{(u, v, p, v')} \SuchThat{|\parents{v'}| > 1}} \\
  \Set[U] &= \SetOf{\decomp{(u, v, p, v')} \SuchThat{|\parents{v'}| = 1 \land v' = \min{\ancestors{v'}}}}%
}

\newcommand{\figureDecompositionDefDecompTerm}{%
\begin{align*}
  \decomp{\e{=}(u, v, p, (u', k))} &= \begin{cases}
    \edecomp{\e} &\quad \sort{k} = Exp \\
    \pdecomp{\e} &\quad \sort{k} = Pat \\
    \tdecomp{\e} &\quad \sort{k} = Typ \\
  \end{cases}
\end{align*}
}

\newcommand{\figureDecompositionDefEdecomp}{%
\begin{align*}
  \edecomp{\e{=}(u, v, p, v'{=}(u', \ExpVar(x)))} &= \eVar{\ingraph{v'}}{x} \\
  \edecomp{\e{=}(u, v, p, v'{=}(u', \ExpLam))} &= \eFun{\ingraph{v'}}{q}{\tau}{e} \\
  & q = \pdecompPrime{\e}{\LamParam} \\
  & \tau = \tdecompPrime{\e}{\LamType} \\
  & e = \edecompPrime{\e}{\LamBody} \\
  \edecomp{\e{=}(u, v, p, v'{=}(u', \ExpApp))} &= \eApp{\ingraph{v'}}{e_\AppFun}{e_\AppArg} \\
  & e_\AppFun = \edecompPrime{\e}{\AppFun} \\
  & e_\AppArg = \edecompPrime{\e}{\AppArg} \\
  \edecomp{\e{=}(u, v, p, v'{=}(u', \ExpNum(n)))} &= \eNum{\ingraph{v'}}{n} \\
  \edecomp{\e{=}(u, v, p, v'{=}(u', \ExpPlus))} &= \ePlus{\ingraph{v'}}{e_\PlusLeft}{e_\PlusRight} \\
  & e_\PlusLeft = \edecompPrime{\e}{\PlusLeft} \\
  & e_\PlusRight = \edecompPrime{\e}{\PlusRight} \\
  \edecomp{\e{=}(u, v, p, v'{=}(u', \ExpTimes))} &= \eTimes{\ingraph{v'}}{e_\TimesLeft}{e_\TimesRight} \\
  & e_\TimesLeft = \edecompPrime{\e}{\TimesLeft} \\
  & e_\TimesRight = \edecompPrime{\e}{\TimesRight}
\end{align*}%
}

\newcommand{\figureDecompositionDefPdecomp}{%
\begin{align*}
  \pdecomp{\e{=}(u, v, p, v'{=}(u', \PatVar(x)))} &= \pVar{\ingraph{v'}}{x}
\end{align*}%
}

\newcommand{\figureDecompositionDefTdecomp}{%
\begin{align*}
  \tdecomp{\e{=}(u, v, p, v'{=}(u', \TypArrow))} &= \tArrow{\ingraph{v'}}{\tau_\ArrowArg}{\tau_\ArrowResult} \\
  & \tau_\ArrowArg = \tdecompPrime{\e}{\ArrowArg} \\
  & \tau_\ArrowResult = \tdecompPrime{\e}{\ArrowResult} \\
  \tdecomp{\e{=}(u, v, p, v'{=}(u', \TypNum))} &= \tNum{\ingraph{v'}}
\end{align*}%
}

\newcommand{\figureDecompositionDefEdecompPrime}{%
\[
  \begin{array}{l}
    \edecompPrime{\e{=}(u, v, p, v')}{p'} = \\
    \left\{
      \begin{array}{ll}
        \conflictHole[i \leq n]{\edecomp{\e_i}}{v'}{p'} &
          \children{v'}{p'} = \SetOf{\e_1, \ldots, \e_n}
        \\
        \multiVertex{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| > 1
        \\
        \cycleVertex{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| = 1
          \\ & \quad
          \land v_1' = \min{\ancestors{v_1'}}
        \\
        \edecomp{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| = 1
          \\ & \quad
          \land v_1' \neq \min{\ancestors{v_1'}}
        \\
        \emptyHole{v'}{p'} & \children{v'}{p'} = \varnothing \\
      \end{array}
    \right.
  \end{array}
\]%
}

\newcommand{\figureDecompositionDefPdecompPrime}{%
\[
  \begin{array}{l}
    \pdecompPrime{\e{=}(u, v, p, v')}{p'} = \\
    \left\{
      \begin{array}{ll}
        \conflictHole[i \leq n]{\pdecomp{\e_i}}{v'}{p'} &
          \children{v'}{p'} = \SetOf{\e_1, \ldots, \e_n}
        \\
        \multiVertex{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| > 1
        \\
        \cycleVertex{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| = 1
          \\ & \quad
          \land v_1' = \min{\ancestors{v_1'}}
        \\
        \pdecomp{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| = 1
          \\ & \quad
          \land v_1' \neq \min{\ancestors{v_1'}}
        \\
        \emptyHole{v'}{p'} & \children{v'}{p'} = \varnothing \\
      \end{array}
    \right.
  \end{array}
\]%
}

\newcommand{\figureDecompositionDefTdecompPrime}{%
\[
  \begin{array}{l}
    \tdecompPrime{\e{=}(u, v, p, v')}{p'} = \\
    \left\{
      \begin{array}{ll}
        \conflictHole[i \leq n]{\tdecomp{\e_i}}{v'}{p'} &
          \children{v'}{p'} = \SetOf{\e_1, \ldots, \e_n}
        \\
        \multiVertex{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| > 1
        \\
        \cycleVertex{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| = 1
          \\ & \quad
          \land v_1' = \min{\ancestors{v_1'}}
        \\
        \tdecomp{\e'} &
          \children{v'}{p'} = \SetOf{\e'{=}(u_1, v_1, p_1, v_1')}
          \land |\parents{v_1'}| = 1
          \\ & \quad
          \land v_1' \neq \min{\ancestors{v_1'}}
        \\
        \emptyHole{v'}{p'} & \children{v'}{p'} = \varnothing \\
      \end{array}
    \right.
  \end{array}
\]%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\figureDecompositionDef}{%
\begin{figure}

\figureDecompositionDefEdecomp

\figureDecompositionDefPdecomp

\figureDecompositionDefTdecomp

\figureDecompositionDefEdecompPrime

\figureDecompositionDefPdecompPrime

\figureDecompositionDefTdecompPrime

\caption{Graph decomposition.}
\label{fig:Graph decomposition definition}
\end{figure}%
}

\newcommand{\figureDecompositionDefHelpers}{%
\begin{figure}
\figureDecompositionDefHelpersContent
\caption{Graph decomposition helpers.}
\label{fig:Graph decomposition definition helpers}
\end{figure}%
}