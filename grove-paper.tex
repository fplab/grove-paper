%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[acmsmall,review,anonymous,nonacm]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}


%% Journal information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{CONF} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2018}
\acmMonth{1}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format must update the '\documentclass' and
%% topmatter commands above; see 'acmart-sigplanproc-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption


\begin{document}

%% Title information
\title[Short Title]{Grove: A Convergent Collaborative Structure-Editor Calculus}         %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
% \subtitle{Subtitle}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{First1 Last1}
\authornote{with author1 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position1}
  \department{Department1}              %% \department is recommended
  \institution{Institution1}            %% \institution is required
  \streetaddress{Street1 Address1}
  \city{City1}
  \state{State1}
  \postcode{Post-Code1}
  \country{Country1}                    %% \country is recommended
}
\email{first1.last1@inst1.edu}          %% \email is recommended

%% Author with two affiliations and emails.
\author{First2 Last2}
\authornote{with author2 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position2a}
  \department{Department2a}             %% \department is recommended
  \institution{Institution2a}           %% \institution is required
  \streetaddress{Street2a Address2a}
  \city{City2a}
  \state{State2a}
  \postcode{Post-Code2a}
  \country{Country2a}                   %% \country is recommended
}
\email{first2.last2@inst2a.com}         %% \email is recommended
\affiliation{
  \position{Position2b}
  \department{Department2b}             %% \department is recommended
  \institution{Institution2b}           %% \institution is required
  \streetaddress{Street3b Address2b}
  \city{City2b}
  \state{State2b}
  \postcode{Post-Code2b}
  \country{Country2b}                   %% \country is recommended
}
\email{first2.last2@inst2b.org}         %% \email is recommended


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
Text of abstract \ldots.
\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
%\begin{CCSXML}
%<ccs2012>
%<concept>
%<concept_id>10011007.10011006.10011008</concept_id>
%<concept_desc>Software and its engineering~General programming languages</concept_desc>
%<concept_significance>500</concept_significance>
%</concept>
%<concept>
%<concept_id>10003456.10003457.10003521.10003525</concept_id>
%<concept_desc>Social and professional topics~History of programming languages</concept_desc>
%<concept_significance>300</concept_significance>
%</concept>
%</ccs2012>
%\end{CCSXML}
%\ccsdesc[500]{Software and its engineering~General programming languages}
%\ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
% \keywords{keyword1, keyword2, keyword3}  %% \keywords are mandatory in final camera-ready submission


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle


\section{Introduction}
\label{sec:introduction}

Motivation: 
- collaborative editing (both synchronous ala Google Docs and asynchronous version control) 
  is good and important as computing grows
- semantic structure editing is good because it solves the gap problem (semantic editor services 
  are always available) -- cite Hazelnut papers (talk about holes)
- previous approaches to collaborative editing have limitations
  - diff/merge based approaches (trying to solve the inverse problem based on final states -- 
    you lose the actual actions that were performed, and have to reconstruct them or an approx.
    of them i.e. add line/delete line actions -- would need to adapt this to structure editing,
    some papers have started to look at that, but fundamentally we don't want to throw away the
    knowledge we have about the edits!)
  - operational transforms (complexity, you have to patch previous actions based on new actions)
  - CRDT-based collaborative editing (that's all been on text, not PL semantics) -- this is good
    because it is relatively simple: you just send all the edits to all the replicas and they are 
    convergent by design
- we want to have the same convergence for a CRDT-based collaborative structure editor that maintains
  the sensibility invariant of Hazelnut, i.e. every editor state has meaning. mention that maintaining sensibility 
  allows scaling of semantic editor services in the presence of large number of collaborators (in contrast,
  using VS Code or other collaborative text editors with large numbers of collaborators means that almost always
  the semantic editor services will be disabled because the program is going to be broken in multiple places
  transiently)

  this is tricky because:
  - some edits might be conflicting -- solve this with "conflict holes"
  - adding cut/paste or delete/restore allows for degenerate programs (cycles, multiple parents, etc.)
- since we are commutative, we solve both synchronus and async collaborative editing
  - and this resolves issues around merges and conflicts
- contribution of this paper is to solve these problems from type-theoretic first principles:
  - ...
- Hazel

\subsection{Contributions and Paper Organization}
\label{sec:paper-organization}

\section{Grove By Example}
\label{sec:grove-by-example}

TODO: somewhere in here, maybe multiple places, we want to talk about typing the intermediate states that arise

\subsection{Scenario A: Editing Different Parts of the Code}
A + B make edits and transmit to C, C is able to resolve without any assistance, 
order that the edits are received doesn't matter you get the same program state
at the end

\subsection{Scenario B: Edits to Nested Parts of the Code}
A edits part of the code

B moves the code surrounding the edits of A to another part of the code

\subsection{Scenario C: Direct Conflicts}

A and B both insert different expressions into the same hole

(think about critiques re: diff)

(compare to what happens when there are conflicts in a VCS, you get 
diff markers inserted into files and the semantic editor services 
no longer understand the code)

\subsection{Scenario D: Deletion of Code Being Edited}
B deletes code that A is editing (introduce notion of identity)

(orphans)

Figure shared between D and E that shows the deleted nodes and restore button

\subsection{Scenario E: Restoring Deleted Code}
If only one restore, then it does what you expect (basically a cut and paste)

If multiple replicas restore to different places, then you get some complexity:

 -- restore isn't a copy, it is a move

Multi-parent

Cycles

(Maybe not in initial grove by example) The A and B diamond example

\section{Formalism}
\label{sec:formalism}

\subsection{Syntax}

\subsection{Convergent Graphs}

Graph CRDT description

Mapping of syntax into the graph representation

Graph actions

holes are not explicit in the graph

\begin{theorem}[Commutativity (convergency?)]

\end{theorem}

\subsection{Type System}
\label{sub:type-system}

conflicts (multiple children in the same spot)

multi-parent

cycles

non-empty holes

\subsection{Semantic Actions}
Mapping to graph actions

Sensibility

\subsection{Agda Mechanization}
\label{sub:agda-mechanization}

\section{Implementation}
\label{sec:implementation}
GRV -- how it is implemented, how it connects to the formalism, describe the graph, 

\section{Related Work}
\label{sec:related-work}

Hazel

CRDTs

Pidjul

Etherpad

Live Share

Git

Darcs

Unision?

\section{Discussion and Conclusion}
\label{sec:conclusion}


%% Acknowledgments
\begin{acks}                            %% acks environment is optional
                                        %% contents suppressed with 'anonymous'
  %% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
  %% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
  %% acknowledge financial support and will be used by metadata
  %% extraction tools.
  This material is based upon work supported by the
  \grantsponsor{GS100000001}{National Science
    Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
  No.~\grantnum{GS100000001}{nnnnnnn} and Grant
  No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
  conclusions or recommendations expressed in this material are those
  of the author and do not necessarily reflect the views of the
  National Science Foundation.
\end{acks}


%% Bibliography
%\bibliography{bibfile}


%% Appendix
\appendix
\section{Appendix}

Text of appendix \ldots

\end{document}
